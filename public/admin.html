<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>CivicConnect â€” Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { font-family: Inter, Arial, sans-serif; }
    img.report-photo { width: 100px; height: 70px; object-fit: cover; border-radius: 6px; }
  </style>
</head>
<body>
<div class="container py-4">
  <h1 class="mb-4">ðŸ“Š JanMitra â€” Admin Dashboard</h1>

  <div class="mb-3">
    <a href="index.html" class="btn btn-outline-primary btn-sm">â¬… Back to User App</a>
  </div>

  <table class="table table-bordered table-hover align-middle">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Photo</th>
        <th>Description</th>
        <th>Category</th>
        <th>Location</th>
        <th>Status</th>
        <th>Reported At</th>
      </tr>
    </thead>
    <tbody id="reportsTable">
      <tr><td colspan="7" class="text-center text-muted">Loading...</td></tr>
    </tbody>
  </table>
</div>

<script>
async function loadReports() {
  const tbody = document.getElementById('reportsTable');
  tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">Loading...</td></tr>';

  try {
    const res = await fetch('/api/reports');
    const reports = await res.json();

    if (!Array.isArray(reports) || reports.length === 0) {
      tbody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No reports yet.</td></tr>';
      return;
    }

    tbody.innerHTML = '';
    for (const r of reports) {
      const tr = document.createElement('tr');
      let locationHTML = r.lat && r.lon
        ? `<a href="https://maps.google.com/?q=${r.lat},${r.lon}" target="_blank">${r.lat.toFixed(5)}, ${r.lon.toFixed(5)}</a>`
        : '<span class="text-muted">N/A</span>';

      tr.innerHTML = `
        <td>${r.id}</td>
        <td><img src="/uploads/${r.filename}" class="report-photo"></td>
        <td>${r.description || ''}</td>
        <td><span class="badge bg-primary">${r.category || ''}</span></td>
        <td>${locationHTML}</td>
        <td><span class="badge bg-warning">${r.status}</span></td>
        <td>${r.created_at}</td>
      `;
      tbody.appendChild(tr);
    }
  } catch (err) {
    tbody.innerHTML = '<tr><td colspan="7" class="text-center text-danger">Error loading reports</td></tr>';
    console.error(err);
  }
}

loadReports();
setInterval(loadReports, 10000);
</script>
</body>
</html>
